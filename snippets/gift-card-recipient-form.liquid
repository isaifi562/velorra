{% comment %}
  Renders gift card recipient form.
  Accepts:
  - product: {Object} product object.
  - form: {Object} the product form object.
  - section: {Object} section to which this snippet belongs.
  Usage:
  {% render 'gift-card-recipient-form', product: product, form: form, section: section %}
{% endcomment %}

<link rel="stylesheet" href="{{- 'form-recipient.css' | asset_url -}}" media="print" onload="this.media='all'">
<noscript>
  {{- 'form-recipient.css' | asset_url | stylesheet_tag -}}
</noscript>

<script src="{{ 'form-recipient.js' | asset_url }}" defer="defer"></script>

<form-recipient
  class="form-recipient"
  data-section-id="{{ section.id }}"
  data-product-variant-id="{{ product.selected_or_first_available_variant.id }}"
>
  {%- assign gift_card_recipient_control_flag = 'properties[__shopify_send_gift_card_to_recipient]' -%}
  {%- assign checkbox_id = 'Recipient-checkbox-' | append: section.id -%}
  {%- assign checkbox_label = 'recipient.form.checkbox' | t -%}

  <input
    type="checkbox"
    class="checkbox__input visually-hidden"
    data-recipient-checkbox
    id="{{- checkbox_id | escape -}}"
    name="{{- gift_card_recipient_control_flag | escape -}}"
    disabled
  />

  <span class="visually-hidden">{{- checkbox_label -}}</span>

  <label
    for="{{- checkbox_id -}}"
    class="checkbox__label p3"
    focusable="false"
  >
    <span class="checkbox__icon motion-reduce">
      {%- render 'icon-checkmark' -%}
    </span>

    {{- checkbox_label -}}
  </label>

  <div class="form-recipient__fields mt-s">
    <div class="form-row">
      <div class="field">
        <label class="field__label" for="Recipient-email-{{ section.id }}">
          <span class="recipient-email-label required">{{ 'recipient.form.email_label' | t }}</span>
          <span class="recipient-email-label optional no-js">
            {{- 'recipient.form.email_label_optional_for_no_js_behavior' | t -}}
          </span>
        </label>

        <input
          class="field__input"
          id="Recipient-email-{{ section.id }}"
          type="email"
          placeholder="{{ 'recipient.form.email' | t }}"
          name="properties[Recipient email]"
          value="{{ form.email }}"
          {% if form.errors contains 'email' %}
            aria-invalid="true"
            aria-describedby="RecipientForm-email-error-{{ section.id }}"
          {% endif %}
          data-recipient-email
        >
      </div>

      <div
        id="RecipientForm-email-error-{{ section.id }}"
        class="form__message js-form-message{% unless form.errors contains 'email' %} hidden{% endunless %}"
      >
        <span class="error-message js-error-message caption color-red">
          {%- if form.errors contains 'email' -%}
            {{ form.errors.messages.email }}.
          {%- endif -%}
        </span>
      </div>
    </div>

    <div class="form-row">
      <div class="field">
        <label class="field__label" for="Recipient-name-{{ section.id }}">
          {{- 'recipient.form.name_label' | t -}}
        </label>

        <input
          class="field__input"
          autocomplete="name"
          type="text"
          id="Recipient-name-{{ section.id }}"
          name="properties[Recipient name]"
          placeholder="{{ 'recipient.form.name' | t }}"
          value="{{ form.name }}"
          {% if form.errors contains 'name' %}
            aria-invalid="true"
            aria-describedby="RecipientForm-name-error-{{ section.id }}"
          {% endif %}
          data-recipient-name
        >
      </div>

      <div
        id="RecipientForm-name-error-{{ section.id }}"
        class="form__message js-form-message{% unless form.errors contains 'name' %} hidden{% endunless %}"
      >
        <span class="error-message js-error-message caption color-red">
          {%- if form.errors contains 'name' -%}
            {{ form.errors.messages.name }}.
          {%- endif -%}
        </span>
      </div>
    </div>

    <div class="form-row">
      {%- assign max_chars_message = 200 -%}
      {%- assign max_chars_message_rendered = 'recipient.form.max_characters' | t: max_chars: max_chars_message -%}
      {%- assign message_label_rendered = 'recipient.form.message_label' | t -%}
      <div class="field">
        <label class="form__label field__label" for="Recipient-message-{{ section.id }}">
          {{ message_label_rendered }}
        </label>

        <textarea
          rows="10"
          id="Recipient-message-{{ section.id }}"
          class="text-area field__input"
          name="properties[Message]"
          maxlength="{{ max_chars_message }}"
          placeholder="{{ 'recipient.form.message' | t }}"
          aria-label="{{ message_label_rendered }} {{ max_chars_message_rendered }}"
          {% if form.errors contains 'message' %}
            aria-invalid="true"
            aria-describedby="RecipientForm-message-error-{{ section.id }}"
          {% endif %}
          data-recipient-message
        >{{ form.message }}</textarea>

        <label class="form__label">
          <small>{{ max_chars_message_rendered }}</small>
        </label>
      </div>

      <div
        id="RecipientForm-message-error-{{ section.id }}"
        class="form__message js-form-message{% unless form.errors contains 'message' %} hidden{% endunless %}"
      >
        <span class="error-message js-error-message caption color-red">
          {%- if form.errors contains 'message' -%}
            {{ form.errors.messages.message }}.
          {%- endif -%}
        </span>
      </div>
    </div>

    <div class="form-row">
      <div class="field">
        <label class="form__label field__label" for="Recipient-send-on-{{ section.id }}">
          {{ 'recipient.form.send_on_label' | t }}
        </label>

        <input
          class="field__input text-body"
          autocomplete="send_on"
          type="date"
          id="Recipient-send-on-{{ section.id }}"
          name="properties[Send on]"
          placeholder="{{ 'recipient.form.send_on' | t }}"
          pattern="\d{4}-\d{2}-\d{2}"
          value="{{ form.send_on }}"
          {% if form.errors contains 'send_on' %}
            aria-invalid="true"
            aria-describedby="RecipientForm-send_on-error-{{ section.id }}"
          {% endif %}
          data-recipient-date
        >
      </div>

      <div
        id="RecipientForm-send_on-error-{{ section.id }}"
        class="form__message js-form-message{% unless form.errors contains 'send_on' %} hidden{% endunless %}"
      >
        <span class="error-message js-error-message caption color-red">
          {%- if form.errors contains 'send_on' -%}
            {{ form.errors.messages.send_on }}.
          {%- endif -%}
        </span>
      </div>
    </div>
  </div>

  <input
    type="hidden"
    name="{{ gift_card_recipient_control_flag }}"
    value="if_present"
    id="Recipient-control-{{ section.id }}"
  >

  <input
    type="hidden"
    name="properties[__shopify_offset]"
    value=""
    id="Recipient-timezone-offset-{{ section.id }}"
    disabled
  >
  </form-recipient>
