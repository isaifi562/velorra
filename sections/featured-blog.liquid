{%-
  liquid
  assign style = ''
  if section.settings.enable_custom_background
    if section.settings.background_gradient != blank
      assign style = ' style="--section-background:' | append: section.settings.background_gradient | append: '"'
    elsif section.settings.background_color != blank
      assign style = ' style="--section-background:' | append: section.settings.background_color | append: '"'
    else
      assign style = ''
    endif
  endif

  capture style_classes
    echo 'color-' | append: section.settings.style | append: ' color-background overflow-hidden'
    if style != ''
      echo ' section-background'
    endif
  endcapture
  assign blog_title = section.settings.heading | default: section.settings.blog.title
  assign blog_url = section.settings.button_url_1 | default: section.settings.blog.url
  assign blocks_with_content_size = 0
  assign slides_html = ''
  capture slide_classes
    echo 'swiper-slide grid__item articles-feed__slide'
    if section.settings.layout == 'slider-right' and blog_title != blank
      echo " grid__item--xs-12 grid__item--s-12"
    else
      echo " grid__item--xs-6 grid__item--s-4"
    endif
  endcapture

  assign loop_limit = section.settings.articles_count
-%}

{%- capture slides_html -%}
  {%- if section.blocks.size > 0 -%}
    {%- for block in section.blocks -%}
      {%- assign blocks_with_content_size = blocks_with_content_size | plus: 1 -%}
      <div class="{{ slide_classes }}" data-id="{{ blocks_with_content_size | minus: 1 }}" {{ block.shopify_attributes }}>
        {%- render 'card-article',
          article_ref: block.settings.article_ref,
          show_author: section.settings.show_author,
          show_date: section.settings.show_date,
          show_excerpt: section.settings.show_excerpt,
          show_tags: section.settings.show_tags
        -%}
      </div><!-- /.swiper-slide -->
    {%- endfor -%}
  {%- elsif section.settings.blog != blank -%}
    {%- for article_ref in section.settings.blog.articles limit: loop_limit -%}
      {%- assign blocks_with_content_size = blocks_with_content_size | plus: 1 -%}
      <div class="{{ slide_classes }}">
        {%- render 'card-article',
          article_ref: article_ref,
          show_author: section.settings.show_author,
          show_date: section.settings.show_date,
          show_excerpt: section.settings.show_excerpt,
          show_tags: section.settings.show_tags
        -%}
      </div><!-- /.swiper-slide -->
    {%- endfor -%}
  {%- else -%}
    {%- assign blocks_with_content_size = loop_limit -%}
    {%- for i in (1..loop_limit) -%}
      <div class="{{ slide_classes }}">
        {%- render 'card-article',
          article_ref: article_ref,
          show_meta: false,
          show_excerpt: false
        -%}
        </div><!-- /.swiper-slide -->
    {%- endfor -%}
  {%- endif -%}
{%- endcapture -%}

{%- unless blocks_with_content_size == 0 -%}
  <link rel="stylesheet" href="{{- 'component-text-content.css' | asset_url -}}" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="{{- 'swiper-bundle.min.css' | asset_url -}}" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="{{- 'component-slider.css' | asset_url -}}" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="{{- 'component-card-article.css' | asset_url -}}" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="{{- 'component-article-meta.css' | asset_url -}}" media="print" onload="this.media='all'">

  <noscript>
    {{- 'component-text-content.css' | asset_url | stylesheet_tag -}}
    {{- 'swiper-bundle.min.css' | asset_url | stylesheet_tag -}}
    {{- 'component-slider.css' | asset_url | stylesheet_tag -}}
    {{- 'component-card-article.css' | asset_url | stylesheet_tag -}}
    {{- 'component-article-meta.css' | asset_url | stylesheet_tag -}}
  </noscript>

  <script src="{{- 'swiper-bundle.min.js' | asset_url -}}" defer="defer" data-theme-script></script>
  <script src="{{- 'slider-component.js' | asset_url -}}" defer="defer" data-theme-script></script>
  <script src="{{- 'articles-carousel.js' | asset_url -}}" defer="defer" data-theme-script></script>

  <div class="section__wrapper {{ style_classes }} {{ section.settings.outer_spacing }} {{ section.settings.inner_spacing }}" {{ style }}>
    <div class="container">
      <div class="grid grid--row-gap-0">
        {%-
          liquid
          assign show_multicolumn = false
          if section.settings.layout == 'slider-right' and blog_title != blank
            assign show_multicolumn = true
          endif
        -%}
        <div class="grid__item collage-grid__header  grid__item--xs-12 pb-m {% if show_multicolumn %}grid__item--s-3 pt-0 pt-xl--large pb-0--large {% else %}grid__item--s-12{% endif %}">
          <div class="container container--full-left">
            {%-
              liquid
              assign buttons_value = 'button_size_1:' | append: section.settings.button_size_1 | append: '$' | append: 'button_style_1:' | append: section.settings.button_style_1 | append: '$' | append: 'button_text_1:' | append: section.settings.button_text_1 | append: '$' | append: 'button_url_1:' | append: blog_url
              render 'text-content', subheading_class: 'sh--2', heading_value: blog_title, heading_size_tag: 'h2', heading_class: section.settings.heading_size, subheading_value: section.settings.subheading, paragraph_value: section.settings.paragraph, paragraph_class: 'p2' buttons: buttons_value
            -%}
          </div>
              <div class="collage-grid__header-right">
        <a href="{{ section.settings.button_link }}" class="btn  button button--solid motion-reduce">{{ section.settings.button_text }}</a>
      </div>
        </div>

        {%- unless section.settings.layout != 'slider-right' and show_multicolumn -%}
          <span class="grid__item grid__item--s-1 small-hide medium-hide"></span>
        {%- endunless -%}

        <div class="grid__item grid__item--xs-12 {% if show_multicolumn %}grid__item--s-8{% else %}grid__item--s-12{% endif %}">
          {%- if blocks_with_content_size < 4 and show_multicolumn == false
              or blocks_with_content_size == 1 and show_multicolumn -%}
            <div class="grid">
              {{ slides_html }}
            </div><!-- /.grid -->
          {% else %}
            {%-
              liquid
              assign autoplay_speed = section.settings.autoplay_speed | times: 1000
              capture slider_attr
                echo 'data-autoplay="' | append: section.settings.autoplay | append: '" '
                echo 'data-autoplay-speed="' | append: autoplay_speed | append: '" '
              endcapture
              assign slider_style = 'infinite-both'
              if show_multicolumn
                assign slider_style = 'infinite-right'
              endif
              render 'slider-component', style: slider_style, content: slides_html, element: 'articles-carousel', class: 'articles-feed', attr: slider_attr, paging_styles: 'left,large'
            -%}
          {%- endif -%}
        </div><!-- /.grid__item -->
      </div><!-- /.grid -->
    </div><!-- /.container -->
  </div><!-- /.section__wrapper -->
{%- endunless -%}

{% schema %}
{
  "name": "t:sections.featured-blog.name",
  "tag": "section",
  "class": "section-featured-blog",
  "settings": [
     {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "More Articles"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "select",
      "id": "style",
      "label": "t:sections.global.settings.style.label",
      "options": [
        {
          "value": "style-1",
          "label": "t:sections.global.settings.style.options.option_1"
        },
        {
          "value": "style-2",
          "label": "t:sections.global.settings.style.options.option_2"
        },
        {
          "value": "style-3",
          "label": "t:sections.global.settings.style.options.option_3"
        }
      ],
      "default": "style-1"
    },
    {
      "type": "select",
      "id": "outer_spacing",
      "label": "t:sections.global.settings.outer-spacing.label",
      "options": [
        {
          "value": "mt-0 mb-0 mt-0--large mb-0--large",
          "label": "t:sections.global.settings.outer-spacing.options.option_1"
        },
        {
          "value": "mt-s mb-s mt-s--large mb-s--large",
          "label": "t:sections.global.settings.outer-spacing.options.option_2"
        },
        {
          "value": "mt-l mb-l mt-l--large mb-l--large",
          "label": "t:sections.global.settings.outer-spacing.options.option_3"
        }
      ],
      "default": "mt-0 mb-0 mt-0--large mb-0--large"
    },
    {
      "type": "select",
      "id": "inner_spacing",
      "label": "t:sections.global.settings.inner-spacing.label",
      "options": [
        {
          "value": "spacing-none",
          "label": "t:sections.global.settings.inner-spacing.options.option_1"
        },
        {
          "value": "spacing-s spacing-s--large",
          "label": "t:sections.global.settings.inner-spacing.options.option_2"
        },
        {
          "value": "spacing-m spacing-m--large",
          "label": "t:sections.global.settings.inner-spacing.options.option_3"
        },
        {
          "value": "spacing-l spacing-l--large",
          "label": "t:sections.global.settings.inner-spacing.options.option_4"
        }
      ],
      "default": "spacing-l spacing-l--large"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "t:sections.featured-blog.settings.layout.label",
      "options": [
        {
          "value": "fullwidth",
          "label": "t:sections.featured-blog.settings.layout.options.option_1.label"
        },
        {
          "value": "slider-right",
          "label": "t:sections.featured-blog.settings.layout.options.option_2.label"
        }
      ],
      "default": "fullwidth"
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.section_colors.header",
      "info": "t:sections.global.settings.section_colors.info"
    },
    {
      "type": "checkbox",
      "id": "enable_custom_background",
      "label": "t:sections.global.settings.section_colors.checkbox",
      "default": false
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "t:sections.global.settings.section_colors.color"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "t:sections.global.settings.section_colors.gradient"
    },
    {
      "type": "header",
      "content": "t:sections.featured-blog.settings.header_content.content"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:sections.global.settings.subheading.label",
      "default": "Add a tagline"
    },
    {
      "type": "richtext",
      "id": "heading",
      "label": "t:sections.global.settings.heading.label",
      "default": "<p>Latest <em><strong>news</strong></em></p>"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "t:sections.global.settings.heading_size.label",
      "options": [
        {
          "value": "h3",
          "label": "t:sections.global.settings.heading_size.options.option_1"
        },
        {
          "value": "h2",
          "label": "t:sections.global.settings.heading_size.options.option_2"
        },
        {
          "value": "h1",
          "label": "t:sections.global.settings.heading_size.options.option_3"
        }
      ],
      "default": "h2"
    },
    {
      "type": "richtext",
      "id": "paragraph",
      "label": "t:sections.global.settings.paragraph.label"
    },
    {
      "type": "header",
      "content": "t:sections.featured-blog.settings.header_button.content"
    },
    {
      "type": "select",
      "id": "button_style_1",
      "label": "t:sections.global.settings.buttons.button.settings.style.label",
      "options": [
        {
          "value": "solid",
          "label": "t:sections.global.settings.buttons.button.settings.style.options.option_1"
        },
        {
          "value": "outline",
          "label": "t:sections.global.settings.buttons.button.settings.style.options.option_2"
        },
        {
          "value": "link",
          "label": "t:sections.global.settings.buttons.button.settings.style.options.option_3"
        }
      ],
      "default": "link"
    },
    {
      "type": "select",
      "id": "button_size_1",
      "label": "t:sections.global.settings.buttons.button.settings.size.label",
      "options": [
        {
          "value": "s",
          "label": "t:sections.global.settings.buttons.button.settings.size.options.option_1"
        },
        {
          "value": "m",
          "label": "t:sections.global.settings.buttons.button.settings.size.options.option_2"
        },
        {
          "value": "l",
          "label": "t:sections.global.settings.buttons.button.settings.size.options.option_3"
        }
      ],
      "default": "s"
    },
    {
      "type": "text",
      "id": "button_text_1",
      "label": "t:sections.global.settings.buttons.button.settings.button_text.label",
      "default": "Explore"
    },
    {
      "type": "url",
      "id": "button_url_1",
      "label": "t:sections.global.settings.buttons.button.settings.button_url.label",
      "info": "t:sections.featured-blog.settings.button_url_1.info"
    },
    {
      "type": "header",
      "content": "t:sections.featured-blog.settings.header_slider.content"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "t:sections.featured-blog.settings.blog.label",
      "info": "t:sections.featured-blog.settings.blog.info"
    },
    {
      "type": "range",
      "id": "articles_count",
      "label": "t:sections.featured-blog.settings.articles_count.label",
      "info": "t:sections.featured-blog.settings.articles_count.info",
      "min": 5,
      "max": 12,
      "step": 1,
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "t:sections.featured-blog.settings.autoplay.label",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "t:sections.featured-blog.settings.autoplay_speed.label",
      "unit": "s",
      "min": 3,
      "max": 10,
      "step": 1,
      "default": 5
    },
    {
      "type": "header",
      "content": "t:sections.featured-blog.settings.header_article.content"
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "t:sections.main-blog.settings.show_author.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "t:sections.main-blog.settings.show_date.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "t:sections.main-blog.settings.show_excerpt.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "t:sections.main-blog.settings.show_tags.label",
      "default": false
    }
  ],
  "blocks": [
    {
      "name": "t:sections.featured-blog.blocks.article.name",
      "type": "article",
      "settings": [
        {
          "type": "article",
          "id": "article_ref",
          "label": "t:sections.featured-blog.blocks.article.settings.article.label",
          "info": "t:sections.featured-blog.blocks.article.settings.article.info"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured-blog.name"
    }
  ],
  "enabled_on": {
    "templates": [
      "*"
    ],
    "groups": [
      "aside"
    ]
  }
}
{% endschema %}
